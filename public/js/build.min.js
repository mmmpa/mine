!function t(e,n,o){function i(s,u){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!u&&c)return c(s,!0);if(r)return r(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var a=n[s]={exports:{}};e[s][0].call(a.exports,function(t){var n=e[s][1][t];return i(n?n:t)},a,a.exports,t,e,n,o)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(t,e,n){var o;e.exports=o={},o.GameContext=t("./contexts/game"),o.SettingContext=t("./contexts/setting")},{"./contexts/game":2,"./contexts/setting":3}],2:[function(t,e,n){var o,i=function(t,e){function n(){this.constructor=t}for(var o in e)r.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;e.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.component=React.createClass({render:function(){return ce({$el:App.View.Game,config:this.props.config})}}),e.prototype.initState=function(t){return t.table=this.createTable(t.config)},e.prototype.expandComponentProps=function(t,e){return{config:t.table}},e.prototype.delegate=function(t){return e.__super__.delegate.apply(this,arguments),t("back",function(t){return function(){return t.props.router.popContext()}}(this)),t("cell:rightClick",function(t){return function(e){return e.rotateMode(),t.update(function(t){return{config:t.config}})}}(this)),t("cell:leftClick",function(t){return function(e){return e.open(),t.update(function(t){return{config:t.config}})}}(this)),t("cell:leftRightClick",function(t){return function(e){return e.openAround(),t.update(function(t){return{config:t.config}})}}(this)),t("restart",function(t){return function(){return t.props.table=t.createTable(t.props.config),t.update(function(t){return{config:t.config}})}}(this)),t("timer",function(t){return function(){return t.props.table.computeTime(),t.update(function(t){return{config:t.config}})}}(this))},e.prototype.createTable=function(t){return new App.Model.Table(t.width,t.height,t.bombs)},e}(Arda.Context)},{}],3:[function(t,e,n){var o,i=function(t,e){function n(){this.constructor=t}for(var o in e)r.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;e.exports=o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.component=React.createClass({render:function(){return ce({$el:App.View.Configuration})}}),e.prototype.initState=function(t){return t},e.prototype.expandComponentProps=function(t,e){return{config:e.config}},e.prototype.delegate=function(t){return e.__super__.delegate.apply(this,arguments),t("preset",function(t){return function(e){return t.props.router.pushContext(App.Context.GameContext,{router:t.props.router,config:e})}}(this)),t("freestyle",function(t){return function(e){return t.props.router.pushContext(App.Context.GameContext,{router:t.props.router,config:e})}}(this))},e}(Arda.Context)},{}],4:[function(t,e,n){(function(n){var o,i=[].slice;e.exports=o={},"undefined"!=typeof window&&null!==window?(window.App=o,window.ce=function(){var t,e;return t=1<=arguments.length?i.call(arguments,0):[],(e=o.Util).ce.apply(e,t)}):(n.App=o,n.ce=function(){var t,e;return t=1<=arguments.length?i.call(arguments,0):[],(e=o.Util).ce.apply(e,t)}),o.Context=t("./context"),o.Util=t("./util"),o.Model=t("./model"),o.View=t("./view"),o.start=function(t){var e;return e=new Arda.Router(Arda.DefaultLayout,t),e.pushContext(o.Context.SettingContext,{router:e})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./context":1,"./model":5,"./util":8,"./view":9}],5:[function(t,e,n){var o;e.exports=o={},o.Cell=t("./models/cell"),o.Table=t("./models/table")},{"./models/cell":6,"./models/table":7}],6:[function(t,e,n){var o,i=function(t,e){return function(){return t.apply(e,arguments)}};e.exports=o=function(){function t(e,n,o){this.table=e,this.x=n,this.y=o,this.countFlagsAround=i(this.countFlagsAround,this),this.countBombsAround=i(this.countBombsAround,this),this.position=this.table.width*this.y+this.x,this.state=t.status.none,this._bomb=!1}return t.status={none:"none",flag:"flag",question:"question",open:"open"},t.prototype.state=null,t.prototype.countBombsAround=function(){return null!=this._counted?this._counted:this._counted=this.table.countBombsAround(this)},t.prototype.countFlagsAround=function(){return this.table.countFlagsAround(this)},t.prototype.hasBomb=function(){return this._bomb},t.prototype.isFlagged=function(){return this.state===t.status.flag},t.prototype.isOpened=function(){return this.state===t.status.open},t.prototype.isOpenable=function(){return!this.isOpened()&&this.state!==t.status.none},t.prototype.installBomb=function(){return this._bomb=!0},t.prototype.open=function(){return this.table.isLocked()?void 0:this.isOpened()||this.isOpenable()?!0:(this.state=t.status.open,this.table.open(this))},t.prototype.openAround=function(){return this.table.isLocked()?void 0:this.isOpened()&&this.countBombsAround()===this.countFlagsAround()?this.table.openAround(this):void 0},t.prototype.rotateMode=function(){return this.isOpened()||this.table.locked?void 0:(this.state=function(){switch(this.state){case t.status.none:return t.status.flag;case t.status.flag:return t.status.question;case t.status.question:return t.status.none}}.call(this),this.table.computeRestBombsCount())},t.prototype.uninstallBomb=function(){return this._bomb=!1},t}()},{}],7:[function(t,e,n){var o,i=function(t,e){return function(){return t.apply(e,arguments)}},r=[].slice;e.exports=o=function(){function t(e,n,o){if(this.width=e,this.height=n,this._bombsCount=null!=o?o:1,this.initCells=i(this.initCells,this),this._bombsCount<1)throw"no bombs";if(this._bombsCount>=this.width*this.height)throw"over bombs";this._cells=this.initCells(),this._bombCellPositions=this.installBombs(this._bombsCount),this._startedTime=+new Date,this.passedTime=0,this.restBomsCount=this._bombsCount,this._blankCellsCount=this._cells.length-this._bombsCount,this.state=t.status.play}return t.status={play:"play",win:"win",lose:"lose"},t.prototype.state=null,t.prototype.computeTime=function(){return this.isLocked()?void 0:this.passedTime=_((+new Date-this._startedTime)/1e3).floor()},t.prototype.countBombsAround=function(t){return _(this.getAroundUnopenedCells(t)).filter(function(t){return t.hasBomb()}).value().length},t.prototype.countFlagsAround=function(t){return _(this.getAroundUnopenedCells(t)).filter(function(t){return t.isFlagged()}).value().length},t.prototype.countFlaggedCell=function(){return _(this._cells).filter(function(t){return t.isFlagged()}).value().length},t.prototype.countOpenedCell=function(){return _(this._cells).filter(function(t){return t.isOpened()}).value().length},t.prototype.countRestBombs=function(){return this._bombsCount-this.countFlaggedCell()},t.prototype.computeRestBombsCount=function(){return this.restBomsCount=this.countRestBombs()},t.prototype.getAroundCellsBase=function(t){var e,n;return _(function(){n=[];for(var o=e=t.y-1,i=t.y+1;i>=e?i>=o:o>=i;i>=e?o++:o--)n.push(o);return n}.apply(this)).map(function(e){return function(n){var o,i;return _(function(){i=[];for(var e=o=t.x-1,n=t.x+1;n>=o?n>=e:e>=n;n>=o?e++:e--)i.push(e);return i}.apply(this)).map(function(t){return e.getPointCell(t,n)}).value()}}(this)).flatten().compact()},t.prototype.getAroundCells=function(t){return this.getAroundCellsBase(t).value()},t.prototype.getAroundUnopenedCells=function(t){return this.getAroundCellsBase(t).select(function(t){return!t.isOpened()}).value()},t.prototype.getCells=function(){return this._cells},t.prototype.getPointCell=function(t,e){return 0>t||0>e||t>this.width-1||e>this.height-1?null:this.getPositionCell(e*this.width+t)},t.prototype.getPositionCell=function(t){return this._cells[t]},t.prototype.initCells=function(){var t;return _(function(){t=[];for(var e=0,n=this.height-1;n>=0?n>=e:e>=n;n>=0?e++:e--)t.push(e);return t}.apply(this)).map(function(t){return function(e){var n;return _(function(){n=[];for(var e=0,o=t.width-1;o>=0?o>=e:e>=o;o>=0?e++:e--)n.push(e);return n}.apply(this)).map(function(n){return new App.Model.Cell(t,n,e)}).value()}}(this)).flatten().value()},t.prototype.installBombs=function(t){var e,n;return e=_(function(){n=[];for(var t=0,e=this._cells.length-1;e>=0?e>=t:t>=e;e>=0?t++:t--)n.push(t);return n}.apply(this)).shuffle().shuffle().value().slice(0,+(t-1)+1||9e9),this.installBombsManually.apply(this,e)},t.prototype.installBombsManually=function(){var t;return t=1<=arguments.length?r.call(arguments,0):[],_(this._cells).each(function(t){return t.uninstallBomb()}).value(),_(t).map(function(t){return function(e){return t.getPositionCell(e).installBomb(),e}}(this)).value()},t.prototype.isLocked=function(){return this.locked},t.prototype.lock=function(){return this.locked=!0},t.prototype.lose=function(){return this.computeTime(),this.state=t.status.lose,_(this._bombsCount).each(function(t){return function(e){return t.getPositionCell(e).open()}}(this)),this.lock()},t.prototype.open=function(t){return this.isLocked()?void 0:t.hasBomb()?this.lose():this._blankCellsCount===this.countOpenedCell()?this.win():0===t.countBombsAround()?this.openAround(t):void 0},t.prototype.openAround=function(t){return _(this.getAroundUnopenedCells(t)).each(function(t){return t.open()}).value()},t.prototype.unlock=function(){return this.locked=!1},t.prototype.win=function(){return this.computeTime(),this.state=t.status.win,this.lock()},t}()},{}],8:[function(t,e,n){var o,i=[].slice;e.exports=o={ce:function(t){var e,n,o,r,s;switch(!0){case null!=t?t.hasOwnProperty("$el"):void 0:return t.className=t.$cn,n=this.ce(t.$inc),_.isArray(n)?React.createElement.apply(React,[t.$el,t].concat(i.call(n))):React.createElement(t.$el,t,n);case _.isArray(t):for(s=[],o=0,r=t.length;r>o;o++)e=t[o],s.push(this.ce(e));return s;case _.isString(t):return t;case _.isNumber(t):return t;case _.isObject(t):return t;default:return""}}}},{}],9:[function(t,e,n){var o;e.exports=o={},o.Table=t("./views/table"),o.Cell=t("./views/cell"),o.Fa=t("./views/fa"),o.Configuration=t("./views/configuration"),o.Preset=t("./views/preset"),o.Game=t("./views/game")},{"./views/cell":10,"./views/configuration":11,"./views/fa":12,"./views/game":13,"./views/preset":14,"./views/table":15}],10:[function(t,e,n){var o;e.exports=o=React.createClass({mixins:[Arda.mixin],render:function(){return ce({$el:"li",$cn:this.genClasses(),ref:"cell",$inc:this.genIncs()})},componentDidMount:function(){var t;return t=React.findDOMNode(this.refs.cell),t.addEventListener("contextmenu",this.onContextMenu),t.addEventListener("mousedown",this.onMouseDown),this.setState({cell:t})},componentWillUnmount:function(){var t;return t=this.state.cell,t.removeEventListener("contextmenu",this.onContextMenu),t.removeEventListener("mousedown",this.onMouseDown)},genClasses:function(){var t;return t=["cell"],this.props.model.isOpened()&&t.push("opened"),t.join(" ")},genIncs:function(){var t;return this.props.model.isOpened()?this.props.model.hasBomb()?ce({$el:App.View.Fa,icon:"bomb"}):(t=this.props.model.countBombsAround(),0===t?"":t):ce({$el:App.View.Fa,icon:this.props.model.state})},onContextMenu:function(t){return t.preventDefault()},onMouseDown:function(t){if(t.preventDefault(),null!=t.buttons)switch(t.buttons){case 1:return this.dispatch("cell:leftClick",this.props.model);case 2:return this.dispatch("cell:rightClick",this.props.model);case 3:return this.dispatch("cell:leftRightClick",this.props.model);case 4:return this.dispatch("cell:middleClick",this.props.model)}else{if(null==t.button)return this.dispatch("cell:leftClick",this.props.model);switch(t.button){case 0:return this.dispatch("cell:leftClick",this.props.model);case 1:return this.dispatch("cell:middleClick",this.props.model);case 2:return this.dispatch("cell:rightClick",this.props.model)}}}})},{}],11:[function(t,e,n){var o;e.exports=o=React.createClass({mixins:[Arda.mixin],initialState:{width:9,height:9,bombs:10},getInitialState:function(){return this.initialState},render:function(){return ce({$el:"div",$cn:"container conf-page",$inc:[ce({$el:"h1",$cn:"main-title",$inc:"No Mines Land"}),ce({$el:"h1",$cn:"conf-page title",$inc:"プリセット"}),ce({$el:"ul",$cn:"conf-page preset-games",$inc:[ce({$el:App.View.Preset,preset:{name:"初級",dat:{width:9,height:9,bombs:10}}}),ce({$el:App.View.Preset,preset:{name:"中級",dat:{width:16,height:16,bombs:40}}}),ce({$el:App.View.Preset,preset:{name:"上級",dat:{width:30,height:16,bombs:99}}})]}),ce({$el:"h1",$cn:"conf-page title",$inc:"フリースタイル"}),ce({$el:"ul",$cn:"conf-page form-layout",$inc:[ce({$el:"li",$cn:"conf-page input-title-layout",$inc:[ce({$el:"label",$cn:"input-title conf-page",$inc:"横"})]}),ce({$el:"li",$cn:"conf-page input-layout",$inc:[ce({$el:"input",$cn:"form-control conf-page",ref:"width",value:this.state.width,onChange:this.genOnChangeValue("width")})]}),ce({$el:"li",$cn:"conf-page input-title-layout",$inc:[ce({$el:"label",$cn:"input-title conf-page",$inc:"縦"})]}),ce({$el:"li",$cn:"conf-page input-layout",$inc:[ce({$el:"input",$cn:"form-control conf-page",ref:"height",value:this.state.height,onChange:this.genOnChangeValue("height")})]}),ce({$el:"li",$cn:"conf-page input-title-layout",$inc:[ce({$el:"label",$cn:"input-title conf-page",$inc:[ce({$el:App.View.Fa,icon:"bomb",fixedWidth:!0})]})]}),ce({$el:"li",$cn:"conf-page input-layout",$inc:[ce({$el:"input",$cn:"form-control conf-page",ref:"bombs",value:this.state.bombs,onChange:this.genOnChangeValue("bombs")})]})]}),ce({$el:"button",$cn:"btn btn-success conf-page wide",onClick:this.onClickFreeStyle,$inc:"スタート"})]})},genOnChangeValue:function(t){return function(e){return function(n){var o,i;return o={},i=+n.target.value,o[t]=function(){switch(!0){case _.isNaN(i):return this.initialState[t];case 1>i:return this.initialState[t];case _.isNumber(i):return i;default:return this.initialState[t]}}.call(e),e.setState(o)}}(this)},onClickFreeStyle:function(t){return t.preventDefault(),this.dispatch("freestyle",{width:React.findDOMNode(this.refs.width).value,height:React.findDOMNode(this.refs.height).value,bombs:React.findDOMNode(this.refs.bombs).value})}})},{}],12:[function(t,e,n){var o;e.exports=o=React.createClass({render:function(){var t;return t=["fa"],t.push("fa-"+this.props.icon),null!=this.props.scale&&t.push("fa-"+this.props.scale+"x"),this.props.fixedWidth&&t.push("fa-fw"),this.props.list&&t.push("fa-li"),this.props.border&&t.push("fa-border"),null!=this.props.pull&&t.push("fa-pull-"+this.props.pull),null!=this.props.animation&&t.push("fa-"+this.props.animation),null!=this.props.rotate&&t.push("fa-rotate-"+this.props.rotate),null!=this.props.flip&&t.push("fa-flip-"+this.props.animation),ce({$el:"i",$cn:t.join(" ")})}})},{}],13:[function(t,e,n){var o;e.exports=o=React.createClass({mixins:[Arda.mixin],render:function(){var t;return t=this.props.config,ce({$el:"div",$inc:[ce({$el:"h1",$cn:"main-title",$inc:"No Mines Land"}),ce({$el:"header",$cn:"game-page header",$inc:[ce({$el:"div",$cn:"game-page time",$inc:[t.passedTime]}),ce({$el:"div",$cn:"game-page restart",$inc:[ce({$el:"button",$cn:"btn btn-"+this.detectColor()+" game-page wide",onClick:this.onClickRestart,$inc:[ce({$el:App.View.Fa,icon:this.detectFace(),scale:2})]})]}),ce({$el:"div",$cn:"game-page rest",$inc:[t.restBomsCount]})]}),ce({$el:"div",$cn:"clearfix",$inc:[ce({$el:App.View.Table,model:this.props.config})]}),ce({$el:"footer",$cn:"game-page footer",$inc:[ce({$el:"button",$cn:"btn btn-success conf-page",onClick:this.onClickBack,$inc:[ce({$el:App.View.Fa,icon:"chevron-circle-left"})," もどる"]})]})]})},componentDidMount:function(){return this.sid=setInterval(function(t){return function(){return t.dispatch("timer")}}(this),1e3)},componentWillUnmount:function(){return clearInterval(this.sid)},detectColor:function(){switch(this.props.config.state){case App.Model.Table.status.play:return"default";case App.Model.Table.status.win:return"primary";case App.Model.Table.status.lose:return"danger"}},detectFace:function(){switch(this.props.config.state){case App.Model.Table.status.play:return"meh-o";case App.Model.Table.status.win:return"smile-o";case App.Model.Table.status.lose:return"frown-o"}},onClickBack:function(t){return t.preventDefault(),this.dispatch("back")},onClickRestart:function(t){return t.preventDefault(),this.dispatch("restart")}})},{}],14:[function(t,e,n){var o;e.exports=o=React.createClass({mixins:[Arda.mixin],render:function(){return ce({$el:"li",$cn:"conf-page preset",$inc:[ce({$el:"button",$cn:"btn btn-primary conf-page wide",onClick:this.onClick,$inc:this.props.preset.name})]})},onClick:function(t){return t.preventDefault(),this.dispatch("preset",this.props.preset.dat)}})},{}],15:[function(t,e,n){var o;e.exports=o=React.createClass({render:function(){return ce({$el:"ul",$cn:"table",$inc:this.genCells(),style:this.genStyles()})},genCells:function(){return _(this.props.model.getCells()).map(function(t){return ce({$el:App.View.Cell,model:t})}).value()},genStyles:function(){return{width:30*this.props.model.width}}})},{}]},{},[4]);